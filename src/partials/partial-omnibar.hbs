/*jslint browser: true, es5: true*/
/*global jQuery, BBAUTH */
(function ($, window, document, undefined) {
  'use strict';

  // Initialize the Omnibar
  BBAUTH.Omnibar.load(document.getElementById("omnibar"), {
    enableSearch: {{ stache.config.omnibar_search }},
    enableHelp: {{ stache.config.omnibar_help }},
    serviceName: '{{ stache.config.omnibar_title }}',
    signInRedirectUrl: '{{ stache.config.omnibar_signin }}',
    signOutRedirectUrl: '{{ stache.config.omnibar_signout }}',
    afterLoad: function () {

      // There's definitly an official way to do this, but I don't have time to find out.
      $('.productmenucontainer').append($('.navbar-nav').clone().toggleClass('nav-items bb-omnibar-productmenu'));

{{# if stache.config.omnibar_search }}

console.log('loading!');
var content = new Bloodhound({
  datumTokenizer: function (d) {
    return Bloodhound.tokenizers.whitespace(d.name);
  },
  queryTokenizer: Bloodhound.tokenizers.whitespace,
  prefetch: {
    url: '/content.json',
    filter: function (response) {
      return response.pages;
    }
  }
});

content.clearRemoteCache();
content.clearPrefetchCache();
content.initialize();

$('#omnibar_searchbox').typeahead(null, {
  source: content.ttAdapter()
});

{{/ if }}

    }
  });

}(jQuery, window, document));

